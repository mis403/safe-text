# Safe-Text é¡¹ç›®å¯åŠ¨æŒ‡å—

## ğŸš€ å¿«é€Ÿå¯åŠ¨ (æ¨è)

### æ–¹æ³•1: ä½¿ç”¨å¯åŠ¨è„šæœ¬ (æœ€ç®€å•)
```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /Users/ws/Developer/safe-text

# ç›´æ¥è¿è¡Œå¯åŠ¨è„šæœ¬
./start_multiprocess.sh
```

### æ–¹æ³•2: æ‰‹åŠ¨å¯åŠ¨å‘½ä»¤
```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /Users/ws/Developer/safe-text

# å¯åŠ¨4ä¸ªå·¥ä½œè¿›ç¨‹çš„APIæœåŠ¡
/Users/ws/Library/Python/3.9/bin/gunicorn -c gunicorn_config.py api_server:app
```

### æ–¹æ³•3: å•è¿›ç¨‹å¼€å‘æ¨¡å¼
```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /Users/ws/Developer/safe-text

# å¼€å‘è°ƒè¯•æ¨¡å¼ (å•è¿›ç¨‹)
python3 api_server.py --port 9900 --debug
```

## ğŸ“‹ å¯åŠ¨å‰æ£€æŸ¥æ¸…å•

### 1. ç¯å¢ƒä¾èµ–æ£€æŸ¥
```bash
# æ£€æŸ¥Pythonç‰ˆæœ¬
python3 --version

# æ£€æŸ¥ä¾èµ–åŒ…
pip3 list | grep -E "(flask|gunicorn|torch|transformers)"
```

### 2. æ¨¡å‹æ–‡ä»¶æ£€æŸ¥
```bash
# æ£€æŸ¥æ˜¯å¦æœ‰è®­ç»ƒå¥½çš„æ¨¡å‹
ls -la outputs/training_*/final_model/
```

### 3. é…ç½®æ–‡ä»¶æ£€æŸ¥
```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶
cat config/training.yaml
cat gunicorn_config.py
```

## ğŸ”§ å¯åŠ¨è¿‡ç¨‹è¯¦è§£

### å¯åŠ¨æµç¨‹
1. **Masterè¿›ç¨‹å¯åŠ¨** - è´Ÿè´£ç®¡ç†å’Œè´Ÿè½½å‡è¡¡
2. **åˆ›å»º4ä¸ªWorkerè¿›ç¨‹** - æ¯ä¸ªè¿›ç¨‹ç‹¬ç«‹è¿è¡Œ
3. **æ¯ä¸ªWorkeråŠ è½½æ¨¡å‹** - ç‹¬ç«‹çš„XLM-RoBERTaå®ä¾‹
4. **å¼€å§‹æ¥æ”¶è¯·æ±‚** - è‡ªåŠ¨åˆ†å‘åˆ°ç©ºé—²è¿›ç¨‹

### å¯åŠ¨æ—¥å¿—ç¤ºä¾‹
```
ğŸš€ å¯åŠ¨Safe-Textå¤šè¿›ç¨‹APIæœåŠ¡...
ğŸ”§ ä½¿ç”¨4ä¸ªå·¥ä½œè¿›ç¨‹å¯åŠ¨æœåŠ¡...

INFO:api_server:ğŸ” è¿›ç¨‹ 7307: æŸ¥æ‰¾æœ€æ–°è®­ç»ƒçš„æ¨¡å‹...
INFO:api_server:ğŸ¤– è¿›ç¨‹ 7307: åŠ è½½æ¨¡å‹ outputs/training_xxx/final_model
INFO:api_server:âœ… è¿›ç¨‹ 7307: æ¨ç†å¼•æ“åˆå§‹åŒ–æˆåŠŸ

INFO:api_server:ğŸ” è¿›ç¨‹ 7308: æŸ¥æ‰¾æœ€æ–°è®­ç»ƒçš„æ¨¡å‹...
INFO:api_server:ğŸ¤– è¿›ç¨‹ 7308: åŠ è½½æ¨¡å‹ outputs/training_xxx/final_model
INFO:api_server:âœ… è¿›ç¨‹ 7308: æ¨ç†å¼•æ“åˆå§‹åŒ–æˆåŠŸ

... (4ä¸ªè¿›ç¨‹éƒ½ä¼šæ˜¾ç¤ºç±»ä¼¼æ—¥å¿—)
```

## ğŸŒ æœåŠ¡å™¨éƒ¨ç½²

### ç”Ÿäº§ç¯å¢ƒå¯åŠ¨
```bash
# 1. ä¸Šä¼ é¡¹ç›®åˆ°æœåŠ¡å™¨
scp -r safe-text/ user@server:/path/to/

# 2. æœåŠ¡å™¨ä¸Šå®‰è£…ä¾èµ–
cd /path/to/safe-text
pip3 install -r requirements.txt

# 3. å¯åŠ¨æœåŠ¡ (åå°è¿è¡Œ)
nohup ./start_multiprocess.sh > server.log 2>&1 &

# 4. æ£€æŸ¥æœåŠ¡çŠ¶æ€
curl -H "Authorization: Bearer safe-text-api-2025-9d8f7e6c5b4a3210" http://localhost:9900/health
```

### Dockeréƒ¨ç½² (å¯é€‰)
```dockerfile
# Dockerfile
FROM python:3.9-slim

WORKDIR /app
COPY . .

RUN pip install -r requirements.txt

EXPOSE 9900

CMD ["./start_multiprocess.sh"]
```

```bash
# æ„å»ºå’Œè¿è¡Œ
docker build -t safe-text .
docker run -p 9900:9900 safe-text
```

## ğŸ” æœåŠ¡éªŒè¯

### 1. å¥åº·æ£€æŸ¥
```bash
curl -H "Authorization: Bearer safe-text-api-2025-9d8f7e6c5b4a3210" \
     http://localhost:9900/health
```

### 2. æµ‹è¯•é¢„æµ‹æ¥å£
```bash
curl -X POST \
     -H "Authorization: Bearer safe-text-api-2025-9d8f7e6c5b4a3210" \
     -H "Content-Type: application/json" \
     -d '{"text":"è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ–‡æœ¬"}' \
     http://localhost:9900/predict
```

### 3. æ£€æŸ¥è¿›ç¨‹çŠ¶æ€
```bash
# æŸ¥çœ‹gunicornè¿›ç¨‹
ps aux | grep gunicorn

# æŸ¥çœ‹ç«¯å£å ç”¨
lsof -i :9900
```

## âš™ï¸ é…ç½®è¯´æ˜

### gunicorn_config.py å…³é”®é…ç½®
```python
workers = 4                    # å·¥ä½œè¿›ç¨‹æ•° (4ä¸ªæ¨¡å‹å®ä¾‹)
worker_connections = 8         # æ¯è¿›ç¨‹è¿æ¥æ•°
bind = "0.0.0.0:9900"         # ç»‘å®šåœ°å€å’Œç«¯å£
timeout = 120                  # è¯·æ±‚è¶…æ—¶æ—¶é—´
```

### æ€§èƒ½è°ƒä¼˜å»ºè®®
- **CPUå¯†é›†**: workers = CPUæ ¸å¿ƒæ•°
- **å†…å­˜å……è¶³**: å¯å¢åŠ åˆ°6-8ä¸ªworkers
- **æ˜¾å­˜é™åˆ¶**: ä¿æŒ4ä¸ªworkers (æ¯ä¸ª~600MB)

## ğŸ›‘ åœæ­¢æœåŠ¡

### æ–¹æ³•1: ä½¿ç”¨PIDæ–‡ä»¶
```bash
# ä¼˜é›…åœæ­¢
kill -TERM `cat /tmp/gunicorn_safe_text.pid`

# å¼ºåˆ¶åœæ­¢
kill -KILL `cat /tmp/gunicorn_safe_text.pid`
```

### æ–¹æ³•2: æŸ¥æ‰¾è¿›ç¨‹åœæ­¢
```bash
# æŸ¥æ‰¾ä¸»è¿›ç¨‹
ps aux | grep gunicorn | grep master

# åœæ­¢ä¸»è¿›ç¨‹ (ä¼šè‡ªåŠ¨åœæ­¢æ‰€æœ‰worker)
kill -TERM <master_pid>
```

## ğŸš¨ å¸¸è§é—®é¢˜

### Q1: å¯åŠ¨å¤±è´¥ "gunicorn: command not found"
```bash
# è§£å†³æ–¹æ¡ˆ: ä½¿ç”¨å®Œæ•´è·¯å¾„
/Users/ws/Library/Python/3.9/bin/gunicorn -c gunicorn_config.py api_server:app
```

### Q2: æ¨¡å‹åŠ è½½å¤±è´¥
```bash
# æ£€æŸ¥æ¨¡å‹æ–‡ä»¶
ls -la outputs/training_*/final_model/config.json

# é‡æ–°è®­ç»ƒæ¨¡å‹
python3 train.py
```

### Q3: ç«¯å£è¢«å ç”¨
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
lsof -i :9900

# æ€æ­»å ç”¨è¿›ç¨‹
kill -9 <pid>
```

### Q4: æƒé™é—®é¢˜
```bash
# ç»™å¯åŠ¨è„šæœ¬æ‰§è¡Œæƒé™
chmod +x start_multiprocess.sh

# æ£€æŸ¥æ—¥å¿—ç›®å½•æƒé™
mkdir -p logs
chmod 755 logs
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### æ—¥å¿—æ–‡ä»¶ä½ç½®
- **åº”ç”¨æ—¥å¿—**: `logs/app.log`
- **Gunicornè®¿é—®æ—¥å¿—**: `logs/gunicorn_access.log`
- **Gunicorné”™è¯¯æ—¥å¿—**: `logs/gunicorn_error.log`

### å®æ—¶ç›‘æ§
```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
tail -f logs/gunicorn_error.log

# æŸ¥çœ‹è¿›ç¨‹èµ„æºä½¿ç”¨
top -p `pgrep -f gunicorn`
```

---

## ğŸ¯ æ€»ç»“

**æœ€ç®€å•çš„å¯åŠ¨æ–¹å¼**:
```bash
cd /Users/ws/Developer/safe-text
./start_multiprocess.sh
```

**éªŒè¯æœåŠ¡**:
```bash
curl -H "Authorization: Bearer safe-text-api-2025-9d8f7e6c5b4a3210" http://localhost:9900/health
```

**ğŸš€ å¯åŠ¨æˆåŠŸåï¼Œæ‚¨å°±æ‹¥æœ‰äº†4ä¸ªæ¨¡å‹å®ä¾‹çš„é«˜æ€§èƒ½APIæœåŠ¡ï¼**
